<!DOCTYPE html>
<html lang="en">
    <style>
    body {
      margin: 0;
      padding: 0;
      background-color: rgb(105, 105, 105);
      user-select: none; /* Disable text selection */
      overflow: hidden; /* Disable scroll */
    }
    main {
      width: 100%;
      height: 100%;
    }
    .arrows {
      position: absolute;
      font-size: 50px;
      border-style: solid;
      border-width: 2px;
      width: 60px;
      height: 60px;
      text-align: center;
      color: black;
      background-color: rgb(135, 142, 148);
      visibility: hidden;
    }
    #left {
      top: 860px;
      left: 92px;
    }
    #down {
      top: 860px;
      left: 160px;
    }
    #up {
      top: 792px;
      left: 160px;
    }
    #right {
      top: 860px;
      left: 228px;
    }
    #restart {
      visibility: hidden;
    }
    </style>
    <body>
        <button type="button" id="start"> Start </button>
        <main></main>
        <div id="status"></div>
        <button type="button" id="restart" onclick="Start()"> Try Again? </button>
        <div class="arrows" id="left">←</div>
        <div class="arrows" id="down">↓</div>
        <div class="arrows" id="up">↑</div>
        <div class="arrows" id="right">→</div>
        <script src="src/joy.js"></script>
        <script>
            leftpressed = false
            uppressed = false
            rightpressed = false
            downpressed = false
            const Container = document.querySelector('main');
            document.body.appendChild(Container);
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            // if isMobile, create joystick
            if (isMobile) {
              const joystickContainer = document.createElement('div')
              joystickContainer.id = "joyDiv"
              joystickContainer.style.position = 'absolute'
              joystickContainer.style.top = '450px'
              joystickContainer.style.left = '20px'
              joystickContainer.style.width = '300px'
              joystickContainer.style.height = '300px'
              Container.appendChild(joystickContainer)
              var joy = new JoyStick('joyDiv')
            }
            // else, show arrow key graphics and create keydown and keyup listeners that set pressed values to true while pressed, and false upon release
            else {
              arrows = document.getElementsByClassName("arrows")
              for (let i = 0; i < arrows.length; i++) {
                arrows[i].style.visibility = "visible"
              }
              document.addEventListener("keydown", function(event) {
                if (event.key == "ArrowLeft"){
                    leftpressed = true
                    left.style.color = "white"
                    left.style.backgroundColor = "black"
                } else if (event.key == "ArrowUp"){
                    uppressed = true
                    up.style.color = "white"
                    up.style.backgroundColor = "black"
                } else if (event.key == "ArrowRight"){
                    rightpressed = true
                    right.style.color = "white"
                    right.style.backgroundColor = "black"
                } else if (event.key == "ArrowDown"){
                    downpressed = true;
                    down.style.color = "white"
                    down.style.backgroundColor = "black"
                }
              });
              document.addEventListener("keyup", function(event) {
                if (event.key == "ArrowLeft"){
                    leftpressed = false;
                    left.style.color = "black";
                    left.style.backgroundColor = "rgb(135, 142, 148)"
                } else if (event.key == "ArrowUp"){
                    uppressed = false;
                    up.style.color = "black";
                    up.style.backgroundColor = "rgb(135, 142, 148)"
                } else if (event.key == "ArrowRight"){
                    rightpressed = false;
                    right.style.color = "black";
                    right.style.backgroundColor = "rgb(135, 142, 148)"
                } else if (event.key == "ArrowDown"){
                    downpressed = false;
                    down.style.color = "black";
                    down.style.backgroundColor = "rgb(135, 142, 148)"
                }
              });
            }
          // Function that waits for given amount of milliseconds
            function sleep(ms) {
              return new Promise(resolve => setTimeout(resolve, ms));
            }
            async function Start() {
              document.getElementById("start").style.display = "none"
              failed = false
              for (let i = 0; i < 5; i++) {
                if (failed == true) {
                  document.getElementById("status").innerHTML = "❌ You failed"
                  document.getElementById("restart").style.visibility = "visible"
                  break
                }
                // get random value
                min = Math.ceil(1);
                max = Math.floor(4);
                random = Math.floor(Math.random() * (max - min) + min);
                if (random == 1) {
                  var img = document.createElement("img");
                  img.src = "Hike.jpeg";
                  img.width = 302;
                  img.height = 330;
                  img.alt = "test";
                  img.id = "img";
                  document.body.appendChild(img);
                  await sleep(5000);
                  if (isMobile) {
                    direction = String(joy.GetDir())
                    checkdir = direction.localeCompare("SW")
                    if (checkdir == 0) { 
                    document.getElementById("status").innerHTML = "✔️"
                    }
                    else {
                      failed = true
                    }
                  }
                  else {
                    if (downpressed == true) { 
                    document.getElementById("status").innerHTML = "SUCCESS"
                    }
                    else {
                      document.getElementById("status").innerHTML = "FAILURE"
                    }
                  }
                const element = document.getElementById('img')
                element.remove()
                }
                else if (random == 2) {
                  var img = document.createElement("img");
                  img.src = "logo.jpg";
                  img.width = 302;
                  img.height = 330;
                  img.alt = "test";
                  img.id = "img";
                  document.body.appendChild(img);
                  await sleep(5000);
                  if (isMobile) {
                    direction = String(joy.GetDir())
                    checkdir = direction.localeCompare("SW")
                    if (checkdir == 0) { 
                    document.getElementById("status").innerHTML = "SUCCESS"
                    }
                    else {
                      document.getElementById("status").innerHTML = "FAILURE"
                    }
                  }
                  else {
                    if (downpressed == true) { 
                    document.getElementById("status").innerHTML = "SUCCESS"
                    }
                    else {
                      document.getElementById("status").innerHTML = "FAILURE"
                    }
                  }
                const element = document.getElementById('img')
                element.remove()
                }
                else if (random == 3) {
                  var img = document.createElement("img");
                  img.src = "Hike.jpeg";
                  img.width = 302;
                  img.height = 330;
                  img.alt = "test";
                  img.id = "img";
                  document.body.appendChild(img);
                  await sleep(5000);
                  if (isMobile) {
                    direction = String(joy.GetDir())
                    checkdir = direction.localeCompare("SW")
                    if (checkdir == 0) { 
                    document.getElementById("status").innerHTML = "SUCCESS"
                    }
                    else {
                      document.getElementById("status").innerHTML = "FAILURE"
                    }
                  }
                  else {
                    if (downpressed == true) { 
                    document.getElementById("status").innerHTML = "SUCCESS"
                    }
                    else {
                      document.getElementById("status").innerHTML = "FAILURE"
                    }
                  }
                const element = document.getElementById('img')
                element.remove()
                }
              }
            }
        </script>
    </body>
</html>